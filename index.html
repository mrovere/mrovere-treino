<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Plano de Treino ‚Äì 4 Semanas</title>

  <!-- Cor da barra do navegador (atualizada via JS conforme tema) -->
  <meta name="theme-color" content="#0f1226" id="meta-theme-color">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ================= THEMES ================= */
    :root{
      --radius:16px;
      /* dark/neon (default) */
      --bg-1:#0f1226; --bg-2:#14183b;
      --txt:#e6e9ff; --muted:#b7bde6;
      --primary:#8b5cf6; --accent:#22d3ee;
      --border:rgba(255,255,255,.15); --shadow:0 8px 30px rgba(2,8,23,.35);
    }
    html[data-theme="light"]{
      --bg-1:#f6f8ff; --bg-2:#ffffff;
      --txt:#0b1027; --muted:#3b4c7a;
      --primary:#7c3aed; --accent:#06b6d4;
      --border:rgba(0,0,0,.12); --shadow:0 8px 28px rgba(10,14,35,.08);
    }

    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; color:var(--txt);
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto;
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(27,31,70,.6) 0%, transparent 60%),
        radial-gradient(1200px 800px at 110% 10%, rgba(10,55,63,.5) 0%, transparent 50%),
        linear-gradient(180deg,var(--bg-1) 0%, var(--bg-1) 100%);
      background-attachment: fixed;
      transition: background .3s ease, color .2s ease;
    }

    header{
      position:sticky; top:0; z-index:20;
      backdrop-filter:saturate(160%) blur(14px);
      background:linear-gradient(90deg, color-mix(in oklab, var(--primary) 20%, transparent),
                                       color-mix(in oklab, var(--accent) 18%, transparent));
      border-bottom:1px solid var(--border);
      padding:14px 16px; display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    h1{margin:0; font-size:1.15rem; font-family:'Space Grotesk',sans-serif; letter-spacing:.3px}
    main{max-width:1100px; margin:24px auto; padding:0 16px}

    .card{
      background: linear-gradient(180deg, color-mix(in oklab, #fff 8%, transparent), color-mix(in oklab, #fff 3%, transparent));
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:22px; margin-bottom:22px; box-shadow: var(--shadow);
    }

    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px}
    th,td{padding:10px; vertical-align:top}
    th{
      background:linear-gradient(90deg, color-mix(in oklab, var(--primary) 45%, transparent),
                                       color-mix(in oklab, var(--accent) 45%, transparent));
      color:#fff; text-align:left; font-weight:700; font-family:'Space Grotesk',sans-serif;
    }
    td{border-bottom:1px solid var(--border); color:var(--muted)}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .right{margin-left:auto}
    .muted{color:var(--muted)}

    /* Bot√µes com micro-anim e glow */
    .btn{
      position:relative;
      background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
      color:#061023;
      border:none; border-radius:12px; padding:10px 16px; cursor:pointer;
      font-weight:700; letter-spacing:.2px;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      box-shadow: 0 6px 20px color-mix(in oklab, var(--primary) 35%, transparent);
      will-change: transform, box-shadow;
    }
    .btn:hover{ transform:translateY(-2px); box-shadow:0 10px 26px color-mix(in oklab, var(--accent) 40%, transparent) }
    .btn:active{ transform:translateY(0) scale(.98) }
    .btn-outline{
      background:transparent; color:color-mix(in oklab, var(--accent) 85%, white);
      border:1px solid color-mix(in oklab, var(--accent) 55%, var(--border));
      box-shadow:none;
    }
    .btn-outline:hover{ filter:drop-shadow(0 0 10px color-mix(in oklab, var(--accent) 30%, transparent)); transform:translateY(-2px) }
    .btn-danger{ background:linear-gradient(90deg,#ef4444,#fb7185); color:#1b0b0b; }

/* Mini-tabela dentro das c√©lulas (Dia A/B/C) */
.cell-table{
  display:grid;
  grid-template-columns: 1fr auto;
  gap: 6px 12px;
  align-items:center;
}
.cell-table .cell-th{
  font-weight:700;
  color:#fff;           /* em tema escuro; ajuste se preferir */
  background: linear-gradient(90deg, color-mix(in oklab, var(--primary, #7c3aed) 45%, transparent),
                                     color-mix(in oklab, var(--accent, #06b6d4) 45%, transparent));
  padding:6px 8px;
  border-radius:8px;
}
.cell-table .cell-tr{
  border-bottom:1px dashed var(--border, rgba(255,255,255,.15));
  padding:6px 0;
}
.cell-table .cell-tr:last-child{ border-bottom:none; }
.cell-table .name{ font-weight:600; }
.cell-table .reps{ color:var(--muted, #b7bde6); white-space:nowrap; }

    
    /* Toggle de tema */
    .theme-toggle{
      display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
      border:1px solid var(--border); background:color-mix(in oklab, #fff 5%, transparent);
      cursor:pointer; font-weight:600; color:var(--txt);
    }
    .theme-toggle svg{width:18px;height:18px}

    .chip{
      display:inline-block; padding:6px 10px; border-radius:999px;
      background:linear-gradient(90deg, color-mix(in oklab, var(--primary) 25%, transparent),
                                       color-mix(in oklab, var(--accent) 25%, transparent));
      color:#f0f6ff; font-size:.85rem; letter-spacing:.2px;
    }
    .activity{border-bottom:1px dashed var(--border); padding:10px 0}

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50;
      background:rgba(4,8,22,.55); backdrop-filter: blur(8px); padding:16px;
    }
    .modal{
      width:100%; max-width:780px; border-radius:20px;
      background: linear-gradient(180deg, color-mix(in oklab, var(--bg-2) 90%, #000), color-mix(in oklab, var(--bg-2) 80%, #000));
      border:1px solid var(--border); box-shadow:0 18px 60px rgba(0,0,0,.5); overflow:hidden; animation:pop .16s ease;
    }
    @keyframes pop{from{transform:scale(.98); opacity:.8} to{transform:scale(1); opacity:1}}
    .modal header{display:flex; align-items:center; gap:10px; padding:16px 18px; border-bottom:1px solid var(--border)}
    .modal .content{padding:18px}
    .modal .footer{padding:16px 18px; border-top:1px solid var(--border); display:flex; gap:10px; justify-content:flex-end; background:color-mix(in oklab,#fff 2%, transparent)}

    .form-field label{display:block; font-weight:700; margin-bottom:6px; font-family:'Space Grotesk',sans-serif}
    .form-field select, .form-field input{
      width:100%; padding:12px 12px; border-radius:12px;
      border:1px solid var(--border); background:color-mix(in oklab,#fff 5%, transparent); color:var(--txt);
      outline:none; transition:border .15s ease, box-shadow .15s ease;
    }
    .form-field select:focus, .form-field input:focus{ border-color:var(--accent); box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 25%, transparent) }

    .exercise-row{
      display:grid; grid-template-columns:1fr 140px 140px; gap:12px; align-items:center;
      padding:10px 0; border-bottom:1px dashed var(--border);
    }
    .exercise-row:last-child{border-bottom:none}

    canvas{background:linear-gradient(180deg, color-mix(in oklab,#fff 4%, transparent), color-mix(in oklab,#fff 2%, transparent)); border:1px solid var(--border); border-radius:14px; padding:10px}

    @media (max-width:780px){ .exercise-row{grid-template-columns:1fr 1fr 1fr} }
  </style>
</head>
<body>
  <header>
    <h1>üèãÔ∏è Plano de Treino ‚Äì 4 Semanas</h1>
    <div class="row">
      <button id="btnTheme" class="theme-toggle" title="Alternar tema">
        <!-- √≠cone muda via JS -->
        <span id="themeIcon"></span>
        <span id="themeLabel">Neon</span>
      </button>
      <span id="userInfo" class="muted">Deslogado</span>
      <button id="btnLogin" class="btn">Entrar com Google</button>
      <button id="btnLogout" class="btn btn-outline" style="display:none">Sair</button>
    </div>
  </header>

  <main>
    <!-- PLANO (refer√™ncia) -->
    <section class="card">
      <div class="row" style="justify-content:space-between">
        <h2 style="margin:0; font-family:'Space Grotesk',sans-serif">Plano (refer√™ncia)</h2>
        <div class="row">
          <button class="btn" id="btnAdd">‚ûï Adicionar atividade</button>
          <button class="btn btn-outline" id="btnExport">Backup (JSON)</button>
          <label class="btn btn-outline" style="cursor:pointer">
            Importar <input type="file" id="importFile" accept="application/json" style="display:none">
          </label>
        </div>
      </div>
      <div class="muted">Fa√ßa login para registrar/visualizar suas atividades. Seus dados ficam no Firestore da sua conta.</div>
      <div style="overflow:auto;margin-top:14px">
<table>
  <tr>
    <th>Semana</th>
    <th>Dia A ‚Äì Ombro + Peito</th>
    <th>Dia B ‚Äì Costas + B√≠ceps</th>
    <th>Dia C ‚Äì Pernas + Tr√≠ceps + Core</th>
  </tr>

  <!-- Semana 1 -->
  <tr>
  <td>1 ‚Äì Adapta√ß√£o</td>
  <td>
    <table class="cell-table">
      <thead>
        <tr><th>Exerc√≠cio</th><th>S√©ries √ó Reps</th></tr>
      </thead>
      <tbody>
        <tr><td class="name">Rota√ß√£o ext/int</td><td class="reps">3√ó12‚Äì15</td></tr>
        <tr><td class="name">Eleva√ß√£o lateral</td><td class="reps">3√ó12‚Äì15</td></tr>
        <tr><td class="name">Desenvolvimento</td><td class="reps">2√ó12‚Äì15</td></tr>
        <tr><td class="name">Supino reto</td><td class="reps">2√ó12‚Äì15</td></tr>
        <tr><td class="name">Flex√£o de bra√ßo</td><td class="reps">2√ófalha</td></tr>
      </tbody>
    </table>
  </td>
  <td>
    <table class="cell-table">
      <thead>
        <tr><th>Exerc√≠cio</th><th>S√©ries √ó Reps</th></tr>
      </thead>
      <tbody>
        <tr><td class="name">Remada</td><td class="reps">3√ó12‚Äì15</td></tr>
        <tr><td class="name">Puxada</td><td class="reps">3√ó12‚Äì15</td></tr>
        <tr><td class="name">Face pull</td><td class="reps">3√ó12‚Äì15</td></tr>
        <tr><td class="name">Rosca direta</td><td class="reps">2√ó12‚Äì15</td></tr>
        <tr><td class="name">Rosca martelo</td><td class="reps">2√ó12‚Äì15</td></tr>
      </tbody>
    </table>
  </td>
  <td>
    <table class="cell-table">
      <thead>
        <tr><th>Exerc√≠cio</th><th>S√©ries √ó Reps</th></tr>
      </thead>
      <tbody>
        <tr><td class="name">Agachamento</td><td class="reps">3√ó12‚Äì15</td></tr>
        <tr><td class="name">Afundo</td><td class="reps">2√ó12‚Äì15</td></tr>
        <tr><td class="name">Terra romeno</td><td class="reps">2√ó12‚Äì15</td></tr>
        <tr><td class="name">Tr√≠ceps testa</td><td class="reps">2√ó12‚Äì15</td></tr>
        <tr><td class="name">Mergulho no banco</td><td class="reps">2√ófalha</td></tr>
        <tr><td class="name">Prancha</td><td class="reps">3√ó30s</td></tr>
        <tr><td class="name">Abdominal infra</td><td class="reps">3√ó12‚Äì15</td></tr>
      </tbody>
    </table>
  </td>
</tr>

  <!-- Semana 2 -->
  <tr>
    <td>2 ‚Äì Consolida√ß√£o</td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Rota√ß√£o ext/int</div><div class="reps">3√ó12</div></div>
        <div class="cell-tr"><div class="name">Eleva√ß√£o lateral</div><div class="reps">3√ó12</div></div>
        <div class="cell-tr"><div class="name">Desenvolvimento</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Supino reto</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Flex√£o de bra√ßo</div><div class="reps">3√ófalha</div></div>
      </div>
    </td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Remada</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Puxada</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Face pull</div><div class="reps">3√ó12</div></div>
        <div class="cell-tr"><div class="name">Rosca direta</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Rosca martelo</div><div class="reps">3√ó10‚Äì12</div></div>
      </div>
    </td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Agachamento</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Afundo</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Terra romeno</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Tr√≠ceps testa</div><div class="reps">3√ó10‚Äì12</div></div>
        <div class="cell-tr"><div class="name">Mergulho no banco</div><div class="reps">3√ófalha</div></div>
        <div class="cell-tr"><div class="name">Prancha</div><div class="reps">3√ó35s</div></div>
        <div class="cell-tr"><div class="name">Abdominal infra</div><div class="reps">3√ó12</div></div>
      </div>
    </td>
  </tr>

  <!-- Semana 3 -->
  <tr>
    <td>3 ‚Äì Progress√£o</td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Rota√ß√£o ext/int</div><div class="reps">3√ó12</div></div>
        <div class="cell-tr"><div class="name">Eleva√ß√£o lateral</div><div class="reps">4√ó10</div></div>
        <div class="cell-tr"><div class="name">Desenvolvimento</div><div class="reps">4√ó8‚Äì10</div></div>
        <div class="cell-tr"><div class="name">Supino reto</div><div class="reps">4√ó8‚Äì10</div></div>
        <div class="cell-tr"><div class="name">Flex√£o de bra√ßo</div><div class="reps">3√ófalha</div></div>
      </div>
    </td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Remada</div><div class="reps">4√ó8‚Äì10</div></div>
        <div class="cell-tr"><div class="name">Puxada</div><div class="reps">4√ó8‚Äì10</div></div>
        <div class="cell-tr"><div class="name">Face pull</div><div class="reps">3√ó12</div></div>
        <div class="cell-tr"><div class="name">Rosca direta</div><div class="reps">3√ó10</div></div>
        <div class="cell-tr"><div class="name">Rosca martelo</div><div class="reps">3√ó10</div></div>
      </div>
    </td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Agachamento</div><div class="reps">4√ó8‚Äì10</div></div>
        <div class="cell-tr"><div class="name">Afundo</div><div class="reps">3√ó10</div></div>
        <div class="cell-tr"><div class="name">Terra romeno</div><div class="reps">3√ó8‚Äì10</div></div>
        <div class="cell-tr"><div class="name">Tr√≠ceps testa</div><div class="reps">3√ó10</div></div>
        <div class="cell-tr"><div class="name">Mergulho no banco</div><div class="reps">3√ófalha</div></div>
        <div class="cell-tr"><div class="name">Prancha</div><div class="reps">3√ó40s</div></div>
        <div class="cell-tr"><div class="name">Abdominal infra</div><div class="reps">3√ó12</div></div>
      </div>
    </td>
  </tr>

  <!-- Semana 4 -->
  <tr>
    <td>4 ‚Äì Choque</td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Rota√ß√£o ext/int</div><div class="reps">3√ó15</div></div>
        <div class="cell-tr"><div class="name">Eleva√ß√£o lateral</div><div class="reps">4√ó12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Desenvolvimento</div><div class="reps">4√ó10‚Äì12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Supino reto</div><div class="reps">4√ó10‚Äì12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Flex√£o de bra√ßo</div><div class="reps">4√ófalha</div></div>
      </div>
    </td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Remada</div><div class="reps">4√ó10‚Äì12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Puxada</div><div class="reps">4√ó10‚Äì12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Face pull</div><div class="reps">4√ó12</div></div>
        <div class="cell-tr"><div class="name">Rosca direta</div><div class="reps">4√ó12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Rosca martelo</div><div class="reps">4√ó12</div></div>
      </div>
    </td>
    <td>
      <div class="cell-table">
        <div class="cell-th">Exerc√≠cio</div><div class="cell-th">S√©ries √ó Reps</div>
        <div class="cell-tr"><div class="name">Agachamento</div><div class="reps">4√ó10‚Äì12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Afundo</div><div class="reps">3√ó12</div></div>
        <div class="cell-tr"><div class="name">Terra romeno</div><div class="reps">4√ó10</div></div>
        <div class="cell-tr"><div class="name">Tr√≠ceps testa</div><div class="reps">4√ó12 (drop)</div></div>
        <div class="cell-tr"><div class="name">Mergulho no banco</div><div class="reps">4√ófalha</div></div>
        <div class="cell-tr"><div class="name">Prancha</div><div class="reps">3√ó45s</div></div>
        <div class="cell-tr"><div class="name">Abdominal infra</div><div class="reps">3√ó15</div></div>
      </div>
    </td>
  </tr>
</table>
      </div>
    </section>

    <!-- HIST√ìRICO -->
    <section class="card">
      <h2 style="margin-top:0; font-family:'Space Grotesk',sans-serif">Hist√≥rico</h2>
      <div id="listaAtividades"></div>
    </section>

    <!-- DASHBOARD -->
    <section class="card">
      <h2 style="margin-top:0; font-family:'Space Grotesk',sans-serif">üìà Dashboard</h2>
      <div class="row" style="margin-bottom:10px">
        <span class="chip">Treinos por semana</span>
        <span class="chip">Volume por grupo</span>
      </div>
      <div class="row" style="gap:16px; flex-wrap:wrap">
        <canvas id="chartSemanas" height="220" style="flex:1 1 360px"></canvas>
        <canvas id="chartGrupos"  height="220" style="flex:1 1 360px"></canvas>
      </div>
      <div class="row" style="margin-top:16px; gap:16px; flex-wrap:wrap">
        <div style="flex:1 1 360px">
          <h3 class="muted" style="margin:6px 0 8px">Tend√™ncia de um exerc√≠cio</h3>
          <div class="row" style="gap:10px;margin-bottom:8px">
            <input id="filterEx" placeholder="Ex.: Supino reto" class="form-input" style="flex:1; padding:10px; border-radius:10px; border:1px solid var(--border); background:color-mix(in oklab,#fff 4%, transparent); color:var(--txt)">
            <button class="btn btn-outline" id="btnFiltrar">Plotar</button>
          </div>
          <canvas id="chartExercicio" height="220"></canvas>
          <div class="muted">Use o nome exatamente como registrou.</div>
        </div>
        <div style="flex:1 1 260px">
          <h3 class="muted" style="margin:6px 0 8px">Estat√≠sticas</h3>
          <div id="stats"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL: adicionar atividade -->
  <div class="modal-backdrop" id="modalAdd">
    <div class="modal">
      <header>
        <h3 style="margin:0; font-family:'Space Grotesk',sans-serif">Adicionar atividade</h3>
        <span class="chip">Marque conclu√≠dos e adicione peso (kg)</span>
        <button class="btn btn-outline right" id="btnCloseModal">Fechar</button>
      </header>
      <div class="content">
        <div class="row" style="gap:14px; flex-wrap:wrap">
          <div class="form-field" style="flex:1 1 220px">
            <label>Semana</label>
            <select id="selSemana">
              <option>Semana 1</option>
              <option>Semana 2</option>
              <option>Semana 3</option>
              <option>Semana 4</option>
            </select>
          </div>
          <div class="form-field" style="flex:1 1 220px">
            <label>Dia</label>
            <select id="selDia">
              <option value="A">Dia A (Ombro + Peito)</option>
              <option value="B">Dia B (Costas + B√≠ceps)</option>
              <option value="C">Dia C (Pernas + Tr√≠ceps + Core)</option>
            </select>
          </div>
          <div class="form-field" style="flex:1 1 220px">
            <label>Data</label>
            <input type="date" id="selData">
          </div>
        </div>

        <div id="exerciseList" style="margin-top:12px"></div>

        <div class="form-field" style="margin-top:12px">
          <label>Observa√ß√µes</label>
          <input id="inpObs" placeholder="Como se sentiu? Observa√ß√µes do dia.">
        </div>
      </div>
      <div class="footer">
        <button class="btn btn-outline" id="btnClearModal">Limpar</button>
        <button class="btn" id="btnSaveModal">Concluir e salvar</button>
      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase SDKs (modular) + App -->
  <script type="module">
    /* ================= FIREBASE CONFIG ================= */
    const firebaseConfig = {
      apiKey: "AIzaSyDmxVS3YbIEZ6E6E6pYnlqEYSnlh2-1-c0",
      authDomain: "mrovere-treino.firebaseapp.com",
      projectId: "mrovere-treino",
      storageBucket: "mrovere-treino.firebasestorage.app",
      messagingSenderId: "699941554235",
      appId: "1:699941554235:web:e96bc21c9fd6dd2df0341e",
      measurementId: "G-CXP4VQKETF"
    };

    /* ============ Imports/Init ============ */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect,
      setPersistence, browserLocalPersistence,
      onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import {
      getFirestore, enableIndexedDbPersistence,
      collection, addDoc, getDocs, query, orderBy,
      updateDoc, doc, deleteDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    enableIndexedDbPersistence(db).catch(()=>{});
    await setPersistence(auth, browserLocalPersistence);

    /* ============ Tema (toggle + persist√™ncia) ============ */
    const THEME_KEY = "app-theme";
    const themeBtn = document.getElementById("btnTheme");
    const themeIcon = document.getElementById("themeIcon");
    const themeLabel = document.getElementById("themeLabel");
    const metaTheme = document.getElementById("meta-theme-color");

    function setTheme(mode){
      document.documentElement.setAttribute("data-theme", mode);
      localStorage.setItem(THEME_KEY, mode);
      // √≠cone + label + theme-color
      if(mode==="light"){
        themeIcon.innerHTML = "‚òÄÔ∏è";
        themeLabel.textContent = "Claro";
        metaTheme.setAttribute("content","#f6f8ff");
      }else{
        themeIcon.innerHTML = "üåô";
        themeLabel.textContent = "Neon";
        metaTheme.setAttribute("content","#0f1226");
      }
    }
    // inicializar tema (pref salvo ou prefer√™ncia do sistema)
    const saved = localStorage.getItem(THEME_KEY);
    if(saved){ setTheme(saved); }
    else{
      const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      setTheme(prefersLight ? "light" : "dark");
    }
    themeBtn.addEventListener("click", ()=>{
      const current = document.documentElement.getAttribute("data-theme");
      setTheme(current==="dark" ? "light" : "dark");
    });

    /* ============ Estado/Helpers (restante do app) ============ */
    let UID = null, chSemanas, chGrupos, chEx;
    const $ = s=>document.querySelector(s), byId=id=>document.getElementById(id);
    const fmtDate = iso => !iso ? "" : new Date(iso+"T00:00:00").toLocaleDateString("pt-BR");
    const todayISO = () => new Date().toISOString().slice(0,10);
    const weekKey = iso => { const d=new Date(iso+"T00:00:00"), one=new Date(d.getFullYear(),0,1); return d.getFullYear()+"-S"+String(Math.ceil((((d-one)/86400000)+one.getDay()+1)/7)).padStart(2,"0"); };
    const sum = a=>a.reduce((x,y)=>x+y,0);

    const PLAN = {
      "Semana 1": { A:["Rota√ß√£o externa/interna","Eleva√ß√£o lateral","Desenvolvimento","Supino reto","Flex√£o de bra√ßo"],
                    B:["Remada curvada","Puxada na frente","Face pull","Rosca direta","Rosca martelo"],
                    C:["Agachamento","Afundo","Terra romeno","Tr√≠ceps testa","Mergulho banco","Prancha","Abdominal infra"] },
      "Semana 2": { A:["Rota√ß√£o externa/interna","Eleva√ß√£o lateral","Desenvolvimento","Supino reto","Flex√£o de bra√ßo"],
                    B:["Remada curvada","Puxada na frente","Face pull","Rosca direta","Rosca martelo"],
                    C:["Agachamento","Afundo","Terra romeno","Tr√≠ceps testa","Mergulho banco","Prancha","Abdominal infra"] },
      "Semana 3": { A:["Rota√ß√£o externa/interna","Eleva√ß√£o lateral","Desenvolvimento","Supino reto","Flex√£o de bra√ßo"],
                    B:["Remada curvada","Puxada na frente","Face pull","Rosca direta","Rosca martelo"],
                    C:["Agachamento","Afundo","Terra romeno","Tr√≠ceps testa","Mergulho banco","Prancha","Abdominal infra"] },
      "Semana 4": { A:["Rota√ß√£o externa/interna","Eleva√ß√£o lateral","Desenvolvimento","Supino reto","Flex√£o de bra√ßo"],
                    B:["Remada curvada","Puxada na frente","Face pull","Rosca direta","Rosca martelo"],
                    C:["Agachamento","Afundo","Terra romeno","Tr√≠ceps testa","Mergulho banco","Prancha","Abdominal infra"] },
    };
    const DIA_TO_GRUPO = { A:"Ombro + Peito", B:"Costas + B√≠ceps", C:"Pernas + Tr√≠ceps + Core" };

    /* ============ Auth (popup/redirect) ============ */
    const userInfo=byId("userInfo"), btnLogin=byId("btnLogin"), btnLogout=byId("btnLogout");
    function isSafariOrIOS(){ const ua=navigator.userAgent; return /iPhone|iPad|iPod/i.test(ua) || /^((?!chrome|android).)*safari/i.test(ua); }
    btnLogin.onclick = async ()=>{
      try{
        const provider = new GoogleAuthProvider();
        if(isSafariOrIOS()) await signInWithRedirect(auth, provider);
        else await signInWithPopup(auth, provider);
      }catch(e){ alert(`Erro de login: ${e.code||e.message}`); }
    };
    btnLogout.onclick = ()=> signOut(auth);

    onAuthStateChanged(auth, async (user)=>{
      if(user){
        UID = user.uid;
        userInfo.textContent = `Ol√°, ${user.displayName || user.email}`;
        btnLogin.style.display="none"; btnLogout.style.display="inline-block";
        await renderHistorico(); renderDash();
      }else{
        UID = null;
        userInfo.textContent = "Deslogado";
        btnLogin.style.display="inline-block"; btnLogout.style.display="none";
        byId("listaAtividades").innerHTML = '<div class="muted">Entre com Google para ver/registrar seus treinos.</div>';
        if(chSemanas) chSemanas.destroy(); if(chGrupos) chGrupos.destroy(); if(chEx) chEx.destroy();
      }
    });

    /* ============ Firestore CRUD ============ */
    import { getDocs as _gd } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js"; // alias s√≥ p/ bundlers n√£o confundirem
    async function fetchActivities(){
      if(!UID) return [];
      const qRef = query(collection(db,"users",UID,"activities"), orderBy("data","desc"));
      const snap = await getDocs(qRef);
      return snap.docs.map(d=>({id:d.id, ...d.data()}));
    }
    async function addActivity(payload){
      payload.createdAt = serverTimestamp(); payload.updatedAt = serverTimestamp();
      await addDoc(collection(db,"users",UID,"activities"), payload);
    }
    async function deleteActivity(id){ await deleteDoc(doc(db,"users",UID,"activities",id)); }
    function calcVolumeBySets(sets){ return (sets||[]).reduce((t,s)=> t + Number(s.series?.[0]?.carga||0), 0); }

    /* ============ Modal Adicionar ============ */
    const modal = byId("modalAdd"), btnAdd=byId("btnAdd"), btnCloseModal=byId("btnCloseModal");
    const selSemana=byId("selSemana"), selDia=byId("selDia"), selData=byId("selData");
    const exerciseList=byId("exerciseList"), btnSaveModal=byId("btnSaveModal"), btnClearModal=byId("btnClearModal"), inpObs=byId("inpObs");

    function openModal(){
      if(!UID){ alert("Entre com Google para adicionar atividades."); return; }
      modal.style.display = "flex";
      selData.value = todayISO();
      renderExercises();
    }
    function closeModal(){ modal.style.display="none"; exerciseList.innerHTML=""; inpObs.value=""; }
    function renderExercises(){
      const semana = selSemana.value, dia = selDia.value;
      const list = PLAN[semana]?.[dia] || [];
      exerciseList.innerHTML = "";
      if(!list.length){ exerciseList.innerHTML = '<div class="muted">Sem exerc√≠cios para esta combina√ß√£o.</div>'; return; }
      list.forEach(name=>{
        const row = document.createElement("div");
        row.className = "exercise-row";
        row.innerHTML = `
          <div style="font-family:'Space Grotesk',sans-serif"><strong>${name}</strong></div>
          <div><input type="number" min="0" step="0.5" placeholder="Peso (kg)" data-weight class="form-input"></div>
          <div class="row"><input type="checkbox" data-done id="chk-${name}"><label for="chk-${name}" class="muted">Conclu√≠do</label></div>
        `;
        exerciseList.appendChild(row);
      });
    }
    btnAdd.onclick = openModal;
    btnCloseModal.onclick = closeModal;
    btnClearModal.onclick = ()=>{ exerciseList.querySelectorAll('input[type="number"]').forEach(i=>i.value=""); exerciseList.querySelectorAll('input[type="checkbox"]').forEach(c=>c.checked=false); };
    selSemana.onchange = renderExercises; selDia.onchange = renderExercises;

    btnSaveModal.onclick = async ()=>{
      if(!UID){ alert("Fa√ßa login."); return; }
      const fase = selSemana.value;
      const dia  = selDia.value;
      const grupo= DIA_TO_GRUPO[dia] || "";
      const data = selData.value || todayISO();
      const obs  = inpObs.value || "";

      const rows = Array.from(exerciseList.querySelectorAll(".exercise-row"));
      const sets = rows.map(r=>{
        const name = r.querySelector("strong").textContent;
        const carga = Number(r.querySelector('[data-weight]').value) || 0;
        const done  = r.querySelector('[data-done]').checked;
        return { exercicio:name, done, series:[{ reps:0, carga }] };
      }).filter(s=> s.done || (s.series?.[0]?.carga||0) > 0);

      if(!sets.length){ alert("Preencha ao menos um peso ou marque algum exerc√≠cio como conclu√≠do."); return; }

      const volume = calcVolumeBySets(sets);
      const payload = { data, fase, grupo, sets, obs, volume };
      await addActivity(payload);
      closeModal();
      await renderHistorico(); renderDash();
    };

    /* ============ Hist√≥rico ============ */
    async function renderHistorico(){
      const cont = byId("listaAtividades");
      cont.innerHTML = '<div class="muted">Carregando‚Ä¶</div>';
      const atividades = await fetchActivities();
      if(!atividades.length){ cont.innerHTML = '<div class="muted">Sem atividades ainda.</div>'; return; }
      cont.innerHTML = "";
      atividades.forEach(a=>{
        const vol = Number(a.volume||0);
        const el = document.createElement("div");
        el.className="activity";
        el.innerHTML = `
          <div>
            <b>${fmtDate(a.data)}</b> ¬∑ <span class="chip">${a.fase}</span> <span class="chip">${a.grupo}</span>
            <span class="right"><button class="btn btn-outline btn-danger" data-del="${a.id}">Excluir</button></span>
          </div>
          <div class="muted">Volume (kg): <b>${vol.toFixed(1)}</b></div>
          <div style="margin-top:6px">
            ${(a.sets||[]).map(s=>{
              const carga = s.series?.[0]?.carga ?? 0;
              const done  = s.done ? "‚úÖ" : "‚¨úÔ∏è";
              return `<div>‚Ä¢ ${done} <b>${s.exercicio}</b> ‚Äî ${carga} kg</div>`;
            }).join("")}
          </div>
          ${a.obs ? `<div class="muted" style="margin-top:6px">Obs: ${a.obs}</div>` : ""}
        `;
        el.querySelector(`[data-del="${a.id}"]`).onclick = async ()=>{
          if(confirm("Excluir esta atividade?")){ await deleteActivity(a.id); await renderHistorico(); renderDash(); }
        };
        cont.appendChild(el);
      });
    }

    /* ============ Dashboard (Chart.js) ============ */
    function palette(n){
      const baseDark = ['#8b5cf6','#06b6d4','#10b981','#f59e0b','#ef4444','#22d3ee','#a78bfa','#34d399'];
      const baseLight= ['#7c3aed','#0891b2','#059669','#d97706','#dc2626','#06b6d4','#8b5cf6','#16a34a'];
      const isLight = document.documentElement.getAttribute("data-theme")==="light";
      const src = isLight ? baseLight : baseDark;
      const arr=[]; for(let i=0;i<n;i++) arr.push(src[i%src.length]); return arr;
    }
    async function renderDash(){
      if(!UID) return;
      const atividades = await fetchActivities();

      const porSemana = {};
      atividades.forEach(a=>{ const wk=weekKey(a.data); porSemana[wk]=(porSemana[wk]||0)+1; });
      const sLabels = Object.keys(porSemana).sort();
      const sVals   = sLabels.map(k=>porSemana[k]);

      const porGrupo = {};
      atividades.forEach(a=>{ porGrupo[a.grupo]=(porGrupo[a.grupo]||0)+Number(a.volume||0); });
      const gLabels = Object.keys(porGrupo);
      const gVals   = gLabels.map(k=>porGrupo[k]);

      const total = atividades.length;
      const totalV= atividades.reduce((t,a)=>t+Number(a.volume||0),0);
      const ultimo= atividades.slice().sort((a,b)=> a.data<b.data?1:-1)[0];
      byId("stats").innerHTML = `
        <div><b>Total de treinos:</b> ${total}</div>
        <div><b>Volume acumulado (kg):</b> ${totalV.toFixed(1)}</div>
        ${ultimo ? `<div><b>√öltimo treino:</b> ${fmtDate(ultimo.data)} ¬∑ <span class="chip">${ultimo.grupo}</span></div>` : ""}
      `;

      const ctxS = byId("chartSemanas").getContext("2d");
      const ctxG = byId("chartGrupos").getContext("2d");
      if(chSemanas) chSemanas.destroy(); if(chGrupos) chGrupos.destroy();

      const axisColor = document.documentElement.getAttribute("data-theme")==="light" ? '#334155' : '#c7d2fe';
      const legendColor = document.documentElement.getAttribute("data-theme")==="light" ? '#0f172a' : '#e2e8f0';

      chSemanas = new Chart(ctxS,{
        type:"bar",
        data:{ labels:sLabels, datasets:[{ label:"Treinos/semana", data:sVals, backgroundColor:palette(sVals.length)}] },
        options:{ responsive:true, scales:{ y:{ beginAtZero:true, ticks:{color:axisColor}}, x:{ticks:{color:axisColor}}}, plugins:{legend:{labels:{color:legendColor}}}}
      });
      chGrupos  = new Chart(ctxG,{
        type:"pie",
        data:{ labels:gLabels, datasets:[{ label:"Volume (kg)", data:gVals, backgroundColor:palette(gVals.length)}] },
        options:{ responsive:true, plugins:{legend:{labels:{color:legendColor}}}}
      });

      // Tend√™ncia por exerc√≠cio
      byId("btnFiltrar").onclick = ()=>{
        const nome = (byId("filterEx").value||"").trim().toLowerCase();
        const ordered = atividades.slice().sort((a,b)=> a.data>b.data?1:-1);
        const labels=[], vol=[], maxLoad=[];
        ordered.forEach(a=>{
          let v=0, max=0;
          (a.sets||[]).forEach(s=>{
            if((s.exercicio||"").toLowerCase()===nome){
              const carga = Number(s.series?.[0]?.carga||0);
              v += carga; if(carga>max) max=carga;
            }
          });
          if(v>0){ labels.push(fmtDate(a.data)); vol.push(v); maxLoad.push(max); }
        });
        const ctx = byId("chartExercicio").getContext("2d");
        if(chEx) chEx.destroy();
        chEx = new Chart(ctx,{
          type:"line",
          data:{ labels, datasets:[
            {label:"Soma das cargas (kg)",data:vol, borderColor:palette(1)[0]},
            {label:"Carga m√°xima (kg)",data:maxLoad, borderColor:palette(2)[1]}
          ]},
          options:{ responsive:true, scales:{ y:{ beginAtZero:true, ticks:{color:axisColor}}, x:{ticks:{color:axisColor}}}, plugins:{legend:{labels:{color:legendColor}}}}
        });
      };
    }

    /* ============ Backup / Restore ============ */
    byId("btnExport").onclick = async ()=>{
      if(!UID){ alert("Fa√ßa login."); return; }
      const data = await fetchActivities();
      const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
      const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "treinos_backup.json"; a.click();
      URL.revokeObjectURL(a.href);
    };
    byId("importFile").addEventListener("change", async (e)=>{
      if(!UID){ alert("Fa√ßa login."); e.target.value=""; return; }
      const f=e.target.files[0]; if(!f) return;
      try{
        const text = await f.text(); const arr = JSON.parse(text);
        if(!Array.isArray(arr)) throw new Error("JSON inv√°lido");
        for(const a of arr){
          const payload = { data:a.data, fase:a.fase, grupo:a.grupo, sets:a.sets||[], obs:a.obs||"", volume:Number(a.volume||0),
            createdAt: serverTimestamp(), updatedAt: serverTimestamp() };
          await addActivity(payload);
        }
        await renderHistorico(); renderDash(); alert("Importa√ß√£o conclu√≠da!");
      }catch(err){ alert("Erro ao importar JSON."); }
      e.target.value="";
    });

    /* ============ Abrir/fechar modal ============ */
    const modalEl = document.getElementById("modalAdd");
    window.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && modalEl.style.display==='flex') modalEl.style.display='none'; });

    /* ============ Registrar Service Worker (PWA) ============ */
    if ('serviceWorker' in navigator) {
      try { await navigator.serviceWorker.register('/sw.js'); } catch(err){ console.warn('SW n√£o registrado', err); }
    }
  </script>
</body>
</html>
